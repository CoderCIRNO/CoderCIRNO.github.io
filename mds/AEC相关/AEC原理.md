# AEC原理

# 概述

        AEC全称是Auto Explosure Control(自动曝光控制)，其目的是调整出图的亮度，让其维持在一个范围内。图像的亮度主要取决于获取图像时的ISO（感光度），曝光时间和光圈大小，手机镜头的光圈往往是固定的，因此大多数情况下只需要考虑ISO和曝光时间。

## ISO

        传统胶片相机的感光度反映了底片对光线的敏感程度；而现代数码相机用CMOS阵列代替底片，CMOS能够捕获光子，可以看成一个光子计数器，它能统计接收到的光子数量，然后转换为电信号。ISO则是对这个输出电信号的放大倍数。

        想要提高画面亮度，可以通过拉高ISO的方式实现，但由于sensor不可避免的硬件缺陷，其输出的信号一定是包含噪音的，对输出电信号的放大同时也会放大这些噪音，使最终输出的图像出现失真。

## 曝光时间

        CMOS作为一个光子计数器，其统计光子数量的时长就可以视为曝光时间，统计的时间越长，自然接收到的光子数量就越多，因此输出的电信号就越强。

        想要提高画面亮度，也可以通过增大曝光时间的方式实现，但当物体快速运动时，成片会将物体在这段曝光时间内的所有位置信息都保留下来，在我们看来就是照片拖影。

## AEC原理

        AEC的过程是一个闭环控制系统，Sensor不断出图，统计当前帧的曝光程度，判断是否过曝或者欠曝，根据结果给出新的AE Target，根据当前曝光程度和AE Target的差距，调整ISO和曝光时间应用到sensor中，并用这套曝光参数来获取下一帧，不断重复上面这一过程直到画面亮度收敛到target附近。

        要详细讲解AEC过程，重点应该放在**如何统计当前帧的曝光程度**、**确定AE Target**以及**调整曝光参数。**
